---
import type { CollectionEntry } from "astro:content";
import Tag from "./Tag.astro";
import { getReadingTime } from "@/utils/readingTime";

interface Props {
  posts: CollectionEntry<"posts">[];
}

const { posts } = Astro.props;

function formatDate(date: Date): string {
  return date.toLocaleDateString("zh-CN", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<ul class="space-y-6">
  {
    posts.map((post, index) => (
      <li
        class="animate-fade-in opacity-0"
        style={`animation-delay: ${index * 0.1}s`}
      >
        <article class="group relative rounded-xl border border-border bg-card p-6 card-hover">
          <a
            href={`${import.meta.env.BASE_URL}/posts/${post.slug}`}
            class="absolute inset-0 z-10"
            aria-label={`Read ${post.data.title}`}
          />
          
          <div class="flex flex-col gap-3">
            <!-- Date & Reading Time -->
            <div class="flex items-center gap-2 text-sm text-muted-foreground">
              <time datetime={post.data.pubDatetime.toISOString()}>
                {formatDate(post.data.pubDatetime)}
              </time>
              <span>&middot;</span>
              <span>{getReadingTime(post.body)}</span>
            </div>

            <!-- Title -->
            <h2 class="text-xl font-semibold text-card-foreground group-hover:text-primary transition-colors">
              {post.data.title}
            </h2>

            <!-- Description -->
            <p class="text-muted-foreground line-clamp-2">
              {post.data.description}
            </p>

            <!-- Tags -->
            <div class="flex flex-wrap gap-2 relative z-20">
              {post.data.tags.map((tag) => (
                <Tag tag={tag} />
              ))}
            </div>
          </div>
        </article>
      </li>
    ))
  }
</ul>
