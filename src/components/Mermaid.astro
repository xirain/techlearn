<!-- Client-side Mermaid diagram rendering -->
<script>
  async function initMermaid() {
    const codeBlocks = document.querySelectorAll("pre > code.language-mermaid");
    if (codeBlocks.length === 0) return;

    const { default: mermaid } = await import("https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs");

    // Detect theme
    const isDark = document.documentElement.classList.contains("theme-dark");
    mermaid.initialize({
      startOnLoad: false,
      theme: isDark ? "dark" : "default",
    });

    for (const codeBlock of codeBlocks) {
      const pre = codeBlock.parentElement;
      if (!pre) continue;

      const container = document.createElement("div");
      container.className = "mermaid-diagram my-6 flex justify-center";

      const id = `mermaid-${Math.random().toString(36).slice(2, 9)}`;
      const { svg } = await mermaid.render(id, codeBlock.textContent || "");
      container.innerHTML = svg;

      pre.replaceWith(container);
    }
  }

  initMermaid();
  document.addEventListener("astro:after-swap", initMermaid);
</script>
