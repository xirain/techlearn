---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

interface Props {
  currentPost: CollectionEntry<"posts">;
}

const { currentPost } = Astro.props;
const seriesName = currentPost.data.series;

if (!seriesName) return;

const allPosts = await getCollection("posts", ({ data }) => !data.draft && data.series === seriesName);
const seriesPosts = allPosts.sort((a, b) => (a.data.seriesOrder ?? 0) - (b.data.seriesOrder ?? 0));
const currentIndex = seriesPosts.findIndex((p) => p.slug === currentPost.slug);
---

{
  seriesPosts.length > 1 && (
    <nav class="mb-8 p-4 rounded-lg border border-border bg-card">
      <h2 class="text-sm font-semibold text-muted-foreground uppercase tracking-wider mb-3">
        专栏：{seriesName}（{currentIndex + 1}/{seriesPosts.length}）
      </h2>
      <ol class="space-y-1.5 text-sm list-decimal list-inside">
        {seriesPosts.map((post, i) => (
          <li class={i === currentIndex ? "font-semibold text-primary" : ""}>
            {i === currentIndex ? (
              <span>{post.data.title}</span>
            ) : (
              <a
                href={`${import.meta.env.BASE_URL}/posts/${post.slug}`}
                class="text-muted-foreground hover:text-primary transition-colors"
              >
                {post.data.title}
              </a>
            )}
          </li>
        ))}
      </ol>
    </nav>
  )
}
