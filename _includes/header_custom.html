<button id="theme-toggle" class="btn" style="margin-left: 1rem;">
  <span id="theme-toggle-icon">üåô</span>
</button>

<script>
(function() {
  function initThemeToggle() {
    const toggleButton = document.getElementById('theme-toggle');
    const toggleIcon = document.getElementById('theme-toggle-icon');

    if (!toggleButton || !toggleIcon) {
      setTimeout(initThemeToggle, 100);
      return;
    }

    // Get current theme from localStorage or check current body class
    let currentTheme = localStorage.getItem('color-scheme') || 'dark';

    // Update icon on page load
    updateIcon(currentTheme);

    // Toggle theme on button click
    toggleButton.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();

      // Toggle theme
      currentTheme = currentTheme === 'dark' ? 'light' : 'dark';

      // Method 1: Try using jtd.setTheme if available
      if (typeof jtd !== 'undefined' && jtd.setTheme) {
        jtd.setTheme(currentTheme);
      }

      // Method 2: Directly manipulate CSS classes
      document.documentElement.setAttribute('data-color-mode', currentTheme);
      document.body.setAttribute('data-color-mode', currentTheme);

      // Update all color scheme meta tags
      const colorSchemeMeta = document.querySelector('meta[name="color-scheme"]');
      if (colorSchemeMeta) {
        colorSchemeMeta.setAttribute('content', currentTheme);
      }

      // Save to localStorage
      localStorage.setItem('color-scheme', currentTheme);

      // Update icon
      updateIcon(currentTheme);

      console.log('Theme switched to:', currentTheme);
    });

    function updateIcon(theme) {
      toggleIcon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      toggleButton.setAttribute('aria-label', theme === 'dark' ? 'ÂàáÊç¢Âà∞ÊµÖËâ≤Ê®°Âºè' : 'ÂàáÊç¢Âà∞Ê∑±Ëâ≤Ê®°Âºè');
      toggleButton.setAttribute('title', theme === 'dark' ? 'ÂàáÊç¢Âà∞ÊµÖËâ≤Ê®°Âºè' : 'ÂàáÊç¢Âà∞Ê∑±Ëâ≤Ê®°Âºè');
    }
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle);
  } else {
    initThemeToggle();
  }
})();
</script>

<style>
  #theme-toggle {
    font-size: 1.2rem;
    padding: 0.5rem;
    cursor: pointer;
    border: none;
    background: transparent;
    transition: transform 0.2s;
  }

  #theme-toggle:hover {
    transform: scale(1.1);
  }

  #theme-toggle:focus {
    outline: 2px solid var(--btn-primary-color);
    outline-offset: 2px;
  }
</style>
